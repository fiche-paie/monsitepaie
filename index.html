<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur de Fiche de Paie SMIC 2025</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            color: #333;
            background-color: #f9f9f9;
            transition: background-color 0.3s, color 0.3s;
        }
        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
            color: #2a4365;
        }
        .required:after {
            content: " *";
            color: #e53e3e;
        }
        input, select {
            width: 90%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            background-color: #fff;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.3);
        }
        button {
            padding: 12px 15px;
            background: #2b6cb0;
            color: white;
            border: none;
            border-radius: 7px;
            cursor: pointer;
            font-size: 15px;
            margin-top: 15px;
            display: block;
            width: 70%;
            transition: background-color 0.3s;
        }
        button:hover {
            background: #2c5282;
        }
        h2 {
            color: #2b6cb0;
            margin-top: 30px;
            border-bottom: 2px solid #bee3f8;
            padding-bottom: 5px;
        }
        .color-picker {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }
        .color-picker label {
            margin-right: 10px;
            width: auto;
        }
        .color-picker input {
            width: 50px;
            height: 30px;
            padding: 0;
            margin: 0;
        }
        .dark-mode {
            background-color: #1a202c;
            color: #cbd5e0;
        }
        .dark-mode input, .dark-mode select {
            background-color: #2d3748;
            color: #cbd5e0;
            border-color: #4a5568;
        }
        .dark-mode button {
            background-color: #4299e1;
        }
        .dark-mode button:hover {
            background-color: #3182ce;
        }
        .apercu-net {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #2b6cb0;
        }
    </style>
</head>
<body>
    <center>
        <h1>Générateur de Fiche de Paie SMIC 2025</h1>
        
        <!-- Informations Entreprise -->
        <h2>Informations Entreprise</h2>
        <label for="nomEntreprise" class="required">Nom</label>
        <input type="text" id="nomEntreprise" value="">

        <label for="adresseEntreprise" class="required">Adresse complète</label>
        <input type="text" id="adresseEntreprise" value="">

        <label for="siret" class="required">SIRET</label>
        <input type="text" id="siret" value="">

        <label for="codeNaf" class="required">Code NAF</label>
        <input type="text" id="codeNaf" value="">

        <label for="telEntreprise" class="required">Téléphone</label>
        <input type="text" id="telEntreprise" value="">

        <label for="faxEntreprise">Fax</label>
        <input type="text" id="faxEntreprise" value="">

        <label for="emailEntreprise" class="required">Email</label>
        <input type="email" id="emailEntreprise" value="">

        <h2>Informations Salarié</h2>
        <label for="nomSalarie" class="required">Nom</label>
        <input type="text" id="nomSalarie" value="JEROME DUBOIS">
        <label for="adresseSalarie" class="required">Adresse complète</label>
        <input type="text" id="adresseSalarie" value="4 rue de la paix, 75000 PARIS">
        <label for="emailSalarie">Email</label>
        <input type="email" id="emailSalarie" value="jerome.dubois@email.com">
        <label for="telSalarie">Téléphone</label>
        <input type="text" id="telSalarie" value="06 12 34 56 78">
        <label for="secuSalarie" class="required">N° Sécurité Sociale</label>
        <input type="text" id="secuSalarie" value="2 2800000000000">
        <label for="dateEntree" class="required">Date d'entrée dans l'entreprise (JJ/MM/AAAA)</label>
        <input type="text" id="dateEntree" value="01/01/2020">
        <label for="posteOccupe" class="required">Poste Occupé</label>
        <input type="text" id="posteOccupe" value="Employé">

        <h2>Période et Salaire</h2>
        <label for="dateDebut" class="required">Date de début de période (JJ/MM/AAAA)</label>
        <input type="text" id="dateDebut" value="01/01/2025">
        <label for="dateFin" class="required">Date de fin de période (JJ/MM/AAAA)</label>
        <input type="text" id="dateFin" value="31/01/2025">
        <label for="tauxHoraire">Taux horaire (€)</label>
        <input type="number" id="tauxHoraire" value="11.88" min="0" step="0.01">
        <label for="heuresMensuelles">Heures mensuelles</label>
        <input type="number" id="heuresMensuelles" value="151.67" min="0" step="0.01">
        <label for="heuresSupplementaires">Heures supplémentaires</label>
        <input type="number" id="heuresSupplementaires" value="0" min="0" step="0.01">
        <label for="majorationHeuresSup">Majoration des heures supplémentaires (%)</label>
        <input type="number" id="majorationHeuresSup" value="25" min="0" step="0.01">
        <label for="salaireBrut" class="required">Salaire Brut Mensuel (€)</label>
        <input type="number" id="salaireBrut" value="1801.80" min="0" step="0.01">
        <label for="statutMarital" class="required">Statut marital</label>
        <select id="statutMarital">
            <option value="1">Célibataire</option>
            <option value="2">Marié(e)</option>
        </select>
        <label for="nbEnfants">Nombre d'enfants</label>
        <input type="number" id="nbEnfants" value="0" min="0">
        <label for="tauxImpot">Taux d'imposition à la source (%)</label>
        <input type="number" id="tauxImpot" value="0" min="0" max="100" step="0.1">

        <!-- Sélecteur de couleur -->
        <div class="color-picker">
            <label for="couleurTheme">Couleur du thème :</label>
            <input type="color" id="couleurTheme" value="#ebf8ff">
        </div>

        <center>
            <div>
                <button type="button" onclick="calculerTauxImpot()" style="margin-top: 7px; width: 200px;">
                    Calculer imposition
                </button>
                <small id="helpImpot" style="display:block; margin-top:6px; color:#666;">
                    Cliquez pour calculer l'impôt sur le revenu
                </small>
            </div>
        </center>

        <button onclick="genererPDF()">Générer paie</button>
        <div class="apercu-net" id="apercuNetAPayer">Net à payer : 1426.30 €</div>
        <button id="toggleDarkMode">Mode Sombre</button>
    </center>

    <!-- Scripts placés à la fin du body -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script>
        // Constantes 2025 - Source URSSAF
        const SMIC_HORAIRE_BRUT = 11.88;
        const SMIC_MENSUEL_BRUT = 1801.80;
        const SMIC_MENSUEL_NET = 1426.30;
        const PLF_SS = 3666; // Plafond Sécurité Sociale
        const HEURES_MENSUELLES = 151.67;

        // Taux de cotisations 2025 - Source URSSAF
        const TAUX_COTISATIONS = {
            // Salariales
            salariales: {
                maladie: { taux: 0.0075, plafonne: true },           // 0.75%
                vieillesse_plafonnee: { taux: 0.069, plafonne: true }, // 6.9%
                vieillesse_deplafonnee: { taux: 0.004, plafonne: false }, // 0.4%
                retraite_complementaire1: { taux: 0.0315, plafonne: true }, // 3.15%
                retraite_complementaire2: { taux: 0.009, plafonne: false, seuil: PLF_SS }, // 0.9%
                chomage: { taux: 0.024, plafonne: true },            // 2.4%
                csg_deductible: { taux: 0.068, plafonne: false },    // 6.8%
                csg_non_deductible: { taux: 0.029, plafonne: false } // 2.9%
            },
            // Patronales
            patronales: {
                maladie: { taux: 0.13, plafonne: true },             // 13%
                vieillesse_plafonnee: { taux: 0.0855, plafonne: true }, // 8.55%
                vieillesse_deplafonnee: { taux: 0.018, plafonne: false }, // 1.8%
                retraite_complementaire1: { taux: 0.08, plafonne: true }, // 8%
                retraite_complementaire2: { taux: 0.016, plafonne: false, seuil: PLF_SS }, // 1.6%
                chomage: { taux: 0.04, plafonne: true },             // 4%
                formation_pro: { taux: 0.01, plafonne: false },      // 1%
                taxe_apprentissage: { taux: 0.0068, plafonne: false }, // 0.68%
                versement_mobilite: { taux: 0.01, plafonne: false }, // 1%
                ags: { taux: 0.0015, plafonne: false }               // 0.15%
            }
        };

        // Tranches d'imposition 2025
        const TRANCHES_IMPOT = [
            { min: 0, max: 11294, taux: 0 },
            { min: 11295, max: 28797, taux: 0.11 },
            { min: 28798, max: 82341, taux: 0.30 },
            { min: 82342, max: 177106, taux: 0.41 },
            { min: 177107, max: Infinity, taux: 0.45 }
        ];

        // Calcul professionnel des cotisations
        function calculerCotisations(brut, type) {
            const cotisations = TAUX_COTISATIONS[type];
            const result = {};
            let total = 0;

            for (const [key, config] of Object.entries(cotisations)) {
                let base = brut;
                
                if (config.plafonne) {
                    base = Math.min(brut, PLF_SS);
                } else if (config.seuil) {
                    base = Math.max(0, brut - config.seuil);
                }
                
                const montant = base * config.taux;
                result[key] = montant;
                total += montant;
            }

            result.total = total;
            return result;
        }

        // Calcul du nombre de parts fiscales
        function getNbParts() {
            const statut = parseInt(document.getElementById('statutMarital').value);
            const enfants = parseInt(document.getElementById('nbEnfants').value) || 0;
            let parts = statut === 2 ? 2 : 1;
            if (enfants > 0) parts += enfants * 0.5;
            return Math.max(1, parts);
        }

        // Calcul professionnel de l'impôt sur le revenu
        function calculerImpot(revenuBrutAnnuel, nbParts) {
            const revenuNetImposable = revenuBrutAnnuel * 0.9; // Abattement 10%
            const revenuParPart = revenuNetImposable / nbParts;
            let impot = 0;

            for (const tranche of TRANCHES_IMPOT) {
                if (revenuParPart > tranche.min) {
                    const montantTranche = Math.min(revenuParPart, tranche.max) - tranche.min;
                    impot += montantTranche * tranche.taux;
                }
            }

            return impot * nbParts;
        }

        // Calcul du net à payer professionnel
        function calculerNetAPayer(salaireBrut, tauxImpot = 0) {
            // Cotisations salariales
            const cotisationsSalariales = calculerCotisations(salaireBrut, 'salariales');
            const totalCotisationsSalariales = cotisationsSalariales.total;
            
            // Net imposable (pour l'impôt)
            const netImposable = salaireBrut - totalCotisationsSalariales + cotisationsSalariales.csg_non_deductible;
            
            // Impôt sur le revenu
            const impotMensuel = (netImposable * tauxImpot) / 100;
            
            // Net à payer
            const netAPayer = netImposable - impotMensuel;
            
            return {
                netImposable: netImposable,
                netAPayer: netAPayer,
                cotisationsSalariales: cotisationsSalariales,
                totalCotisationsSalariales: totalCotisationsSalariales,
                impotMensuel: impotMensuel
            };
        }

        // Mise à jour de l'aperçu net
        function updateApercuNet() {
            const salaireBrut = parseFloat(document.getElementById("salaireBrut").value) || 0;
            const tauxImpot = parseFloat(document.getElementById("tauxImpot").value) || 0;
            
            const resultat = calculerNetAPayer(salaireBrut, tauxImpot);
            document.getElementById("apercuNetAPayer").textContent = 
                `Net à payer : ${resultat.netAPayer.toFixed(2)} €`;
        }

        // Calcul de l'impôt et mise à jour du taux
        window.calculerTauxImpot = function() {
            const salaireBrutMensuel = parseFloat(document.getElementById('salaireBrut').value) || 0;
            const revenuBrutAnnuel = salaireBrutMensuel * 12;
            const nbParts = getNbParts();
            
            const impotAnnuel = calculerImpot(revenuBrutAnnuel, nbParts);
            const tauxImpot = (impotAnnuel / revenuBrutAnnuel) * 100;
            
            document.getElementById('tauxImpot').value = tauxImpot.toFixed(2);
            document.getElementById('helpImpot').innerHTML = 
                `Brut annuel: ${revenuBrutAnnuel.toFixed(0)} € | ${nbParts} part(s) | Impôt annuel: ${impotAnnuel.toFixed(2)} €`;
            
            updateApercuNet();
        }

        // Calcul automatique du salaire brut
        function updateSalaireBrut() {
            const tauxHoraire = parseFloat(document.getElementById("tauxHoraire").value) || 0;
            const heuresMensuelles = parseFloat(document.getElementById("heuresMensuelles").value) || 0;
            const salaireBrut = tauxHoraire * heuresMensuelles;
            document.getElementById("salaireBrut").value = salaireBrut.toFixed(2);
            updateApercuNet();
        }

        // Génération du PDF
        window.genererPDF = function() {
            const { jsPDF } = window.jspdf;
            
            // Récupération des données
            const nomEntreprise = document.getElementById("nomEntreprise").value || "ENTREPRISE";
            const adresseEntreprise = document.getElementById("adresseEntreprise").value || "Adresse";
            const siret = document.getElementById("siret").value || "SIRET";
            const codeNaf = document.getElementById("codeNaf").value || "NAF";
            const telEntreprise = document.getElementById("telEntreprise").value || "Tel";
            const emailEntreprise = document.getElementById("emailEntreprise").value || "Email";
            
            const nomSalarie = document.getElementById("nomSalarie").value || "SALARIE";
            const adresseSalarie = document.getElementById("adresseSalarie").value || "Adresse";
            const secuSalarie = document.getElementById("secuSalarie").value || "Secu";
            const dateEntree = document.getElementById("dateEntree").value || "01/01/2020";
            const posteOccupe = document.getElementById("posteOccupe").value || "Poste";
            
            const dateDebut = document.getElementById("dateDebut").value || "01/01/2025";
            const dateFin = document.getElementById("dateFin").value || "31/01/2025";
            const salaireBrut = parseFloat(document.getElementById("salaireBrut").value) || 0;
            const tauxImpot = parseFloat(document.getElementById("tauxImpot").value) || 0;

            // Calculs professionnels
            const result = calculerNetAPayer(salaireBrut, tauxImpot);
            const cotisationsPatronales = calculerCotisations(salaireBrut, 'patronales');

            // Création du PDF
            const doc = new jsPDF();
            
            // En-tête
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 128);
            doc.text("BULLETIN DE SALAIRE", 105, 15, { align: 'center' });
            
            // Informations entreprise
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            doc.text("EMPLOYEUR:", 20, 25);
            doc.text(nomEntreprise, 20, 30);
            doc.text(adresseEntreprise, 20, 35);
            doc.text(`SIRET: ${siret} - NAF: ${codeNaf}`, 20, 40);
            doc.text(`Tel: ${telEntreprise} - Email: ${emailEntreprise}`, 20, 45);
            
            // Informations salarié
            doc.text("SALARIÉ:", 120, 25);
            doc.text(nomSalarie, 120, 30);
            doc.text(adresseSalarie, 120, 35);
            doc.text(`Securité Sociale: ${secuSalarie}`, 120, 40);
            doc.text(`Entrée: ${dateEntree} - Poste: ${posteOccupe}`, 120, 45);
            
            // Période
            doc.text(`PÉRIODE DU ${dateDebut} AU ${dateFin}`, 105, 55, { align: 'center' });
            
            // Tableau principal
            const tableData = [
                ["SALAIRE BRUT", "", "", salaireBrut.toFixed(2)],
                ["Cotisations salariales", "", "", ""],
                ["- Maladie (0.75%)", "", "", result.cotisationsSalariales.maladie.toFixed(2)],
                ["- Vieillesse plafonnée (6.9%)", "", "", result.cotisationsSalariales.vieillesse_plafonnee.toFixed(2)],
                ["- Vieillesse déplafonnée (0.4%)", "", "", result.cotisationsSalariales.vieillesse_deplafonnee.toFixed(2)],
                ["- Retraite compl. tranche 1 (3.15%)", "", "", result.cotisationsSalariales.retraite_complementaire1.toFixed(2)],
                ["- Retraite compl. tranche 2 (0.9%)", "", "", result.cotisationsSalariales.retraite_complementaire2.toFixed(2)],
                ["- Assurance chômage (2.4%)", "", "", result.cotisationsSalariales.chomage.toFixed(2)],
                ["- CSG déductible (6.8%)", "", "", result.cotisationsSalariales.csg_deductible.toFixed(2)],
                ["- CSG/CRDS non déductible (2.9%)", "", "", result.cotisationsSalariales.csg_non_deductible.toFixed(2)],
                ["TOTAL COTISATIONS SALARIALES", "", "", result.totalCotisationsSalariales.toFixed(2)],
                ["NET IMPOSABLE", "", "", result.netImposable.toFixed(2)],
                ["Impôt sur le revenu", `${tauxImpot.toFixed(2)}%`, "", result.impotMensuel.toFixed(2)],
                ["NET À PAYER", "", "", result.netAPayer.toFixed(2)]
            ];
            
            doc.autoTable({
                startY: 65,
                head: [['DÉSIGNATION', 'TAUX', 'BASE', 'MONTANT']],
                body: tableData,
                theme: 'grid',
                styles: { fontSize: 8 },
                headStyles: { fillColor: [0, 0, 128] },
                columnStyles: {
                    0: { cellWidth: 90 },
                    1: { cellWidth: 25 },
                    2: { cellWidth: 25 },
                    3: { cellWidth: 30, halign: 'right' }
                }
            });
            
            // Cotisations patronales
            const tablePatronales = [
                ["Cotisations patronales", "", "", ""],
                ["- Maladie (13%)", "", "", cotisationsPatronales.maladie.toFixed(2)],
                ["- Vieillesse plafonnée (8.55%)", "", "", cotisationsPatronales.vieillesse_plafonnee.toFixed(2)],
                ["- Vieillesse déplafonnée (1.8%)", "", "", cotisationsPatronales.vieillesse_deplafonnee.toFixed(2)],
                ["- Retraite compl. tranche 1 (8%)", "", "", cotisationsPatronales.retraite_complementaire1.toFixed(2)],
                ["- Retraite compl. tranche 2 (1.6%)", "", "", cotisationsPatronales.retraite_complementaire2.toFixed(2)],
                ["- Assurance chômage (4%)", "", "", cotisationsPatronales.chomage.toFixed(2)],
                ["- Formation professionnelle (1%)", "", "", cotisationsPatronales.formation_pro.toFixed(2)],
                ["- Taxe apprentissage (0.68%)", "", "", cotisationsPatronales.taxe_apprentissage.toFixed(2)],
                ["- Versement mobilité (1%)", "", "", cotisationsPatronales.versement_mobilite.toFixed(2)],
                ["- AGS (0.15%)", "", "", cotisationsPatronales.ags.toFixed(2)],
                ["TOTAL COTISATIONS PATRONALES", "", "", cotisationsPatronales.total.toFixed(2)]
            ];
            
            doc.autoTable({
                startY: doc.lastAutoTable.finalY + 10,
                body: tablePatronales,
                theme: 'grid',
                styles: { fontSize: 8 },
                columnStyles: {
                    0: { cellWidth: 90 },
                    1: { cellWidth: 25 },
                    2: { cellWidth: 25 },
                    3: { cellWidth: 30, halign: 'right' }
                }
            });
            
            // Signature
            doc.text("Fait à ___________________, le ___________________", 20, doc.lastAutoTable.finalY + 20);
            doc.text("Signature et cachet de l'employeur", 20, doc.lastAutoTable.finalY + 30);
            
            // Sauvegarde
            doc.save(`bulletin_${nomSalarie.replace(/\s+/g, '_')}.pdf`);
        }

        // Initialisation des événements
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById("tauxHoraire").addEventListener("input", updateSalaireBrut);
            document.getElementById("heuresMensuelles").addEventListener("input", updateSalaireBrut);
            document.getElementById("salaireBrut").addEventListener("input", updateApercuNet);
            document.getElementById("tauxImpot").addEventListener("input", updateApercuNet);
            document.getElementById("statutMarital").addEventListener("change", calculerTauxImpot);
            document.getElementById("nbEnfants").addEventListener("change", calculerTauxImpot);
            
            document.getElementById("toggleDarkMode").addEventListener("click", function() {
                document.body.classList.toggle("dark-mode");
            });
            
            // Calcul initial
            updateApercuNet();
        });

        // Désactiver le clic droit
        document.addEventListener('contextmenu', function(event) {
            event.preventDefault();
        });
    </script>
</body>
</html>
