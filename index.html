<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur de Fiche de Paie SMIC 2025</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            color: #333;
            background-color: #f9f9f9;
            transition: background-color 0.3s, color 0.3s;
        }
        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
            color: #2a4365;
        }
        .required:after {
            content: " *";
            color: #e53e3e;
        }
        input, select {
            width: 90%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 4px;
            background-color: #fff;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 2px rgba(66, 153, 225, 0.3);
        }
        button {
            padding: 12px 15px;
            background: #2b6cb0;
            color: white;
            border: none;
            border-radius: 7px;
            cursor: pointer;
            font-size: 15px;
            margin-top: 15px;
            display: block;
            width: 70%;
            transition: background-color 0.3s;
        }
        button:hover {
            background: #2c5282;
        }
        h2 {
            color: #2b6cb0;
            margin-top: 30px;
            border-bottom: 2px solid #bee3f8;
            padding-bottom: 5px;
        }
        .color-picker {
            display: flex;
            align-items: center;
            margin: 15px 0;
        }
        .color-picker label {
            margin-right: 10px;
            width: auto;
        }
        .color-picker input {
            width: 50px;
            height: 30px;
            padding: 0;
            margin: 0;
        }
        .dark-mode {
            background-color: #1a202c;
            color: #cbd5e0;
        }
        .dark-mode input, .dark-mode select {
            background-color: #2d3748;
            color: #cbd5e0;
            border-color: #4a5568;
        }
        .dark-mode button {
            background-color: #4299e1;
        }
        .dark-mode button:hover {
            background-color: #3182ce;
        }
        .apercu-net {
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #2b6cb0;
        }
      </style>
</head>
<center>
    
<!-- Informations Entreprise -->
        <label for="nomEntreprise" class="required">Nom</label>
        <input type="text" id="nomEntreprise" value="">

        <label for="adresseEntreprise" class="required">Adresse complète</label>
        <input type="text" id="adresseEntreprise" value="">

        <label for="siret" class="required">SIRET</label>
        <input type="text" id="siret" value="">

        <label for="codeNaf" class="required">Code NAF</label>
        <input type="text" id="codeNaf" value="">

        <label for="telEntreprise" class="required">Téléphone</label>
        <input type="text" id="telEntreprise" value="">

        <label for="faxEntreprise">Fax</label>
        <input type="text" id="faxEntreprise" value="">

        <label for="emailEntreprise" class="required">Email</label>
        <input type="email" id="emailEntreprise" value="">

    
 <label for="logo">Logo (URL ou chemin local):</label>
    <input type="file" id="logo" accept="image/*">
    <img id="logoPreview" src="#" alt="Logo Preview" style="display:none; max-width:100px; margin-top:10px;">

    
        <h2>Informations Salarié</h2>
        <label for="nomSalarie" class="required">Nom</label>
        <input type="text" id="nomSalarie" value="JEROME DUBOIS">
        <label for="adresseSalarie" class="required">Adresse complète</label>
        <input type="text" id="adresseSalarie" value="4 rue de la paix, 75000 PARIS">
        <label for="emailSalarie">Email</label>
        <input type="email" id="emailSalarie" value="jerome.dubois@email.com">
        <label for="telSalarie">Téléphone</label>
        <input type="text" id="telSalarie" value="06 12 34 56 78">
        <label for="secuSalarie" class="required">N° Sécurité Sociale</label>
        <input type="text" id="secuSalarie" value="2 2800000000000">
        <label for="dateEntree" class="required">Date d'entrée dans l'entreprise (JJ/MM/AAAA)</label>
        <input type="text" id="dateEntree" value="01/01/2020">
        <label for="posteOccupe" class="required">Poste Occupé</label>
        <input type="text" id="posteOccupe" value="Employé">
        <h2>Période et Salaire</h2>
        <label for="dateDebut" class="required">Date de début de période (JJ/MM/AAAA)</label>
        <input type="text" id="dateDebut" value="01/01/2025">
        <label for="dateFin" class="required">Date de fin de période (JJ/MM/AAAA)</label>
        <input type="text" id="dateFin" value="31/01/2025">
        <label for="tauxHoraire">Taux horaire (€)</label>
        <input type="number" id="tauxHoraire" value="11.88" min="0" step="0.01">
        <label for="heuresMensuelles">Heures mensuelles</label>
        <input type="number" id="heuresMensuelles" value="151.67" min="0" step="0.01">
        <label for="heuresSupplementaires">Heures supplémentaires</label>
        <input type="number" id="heuresSupplementaires" value="0" min="0" step="0.01">
        <label for="majorationHeuresSup">Majoration des heures supplémentaires (%)</label>
        <input type="number" id="majorationHeuresSup" value="25" min="0" step="0.01">
        <label for="salaireBrut" class="required">Salaire Brut Mensuel (€)</label>
        <input type="number" id="salaireBrut" value="1801.80" min="0" step="0.01">
        <label for="statutMarital" class="required">Statut marital</label>
        <select id="statutMarital">
            <option value="1">Célibataire</option>
            <option value="2">Marié(e)</option>
        </select>
        <label for="nbEnfants">Nombre d'enfants</label>
        <input type="number" id="nbEnfants" value="0" min="0">
        <label for="tauxImpot">Taux d'imposition à la source (%)</label>
        <input type="number" id="tauxImpot" value="0" min="0" max="100" step="0.1">
        <!-- Sélecteur de couleur -->
        <div class="color-picker">
            <label for="couleurTheme">Couleur du thème :</label>
            <input type="color" id="couleurTheme" value="#ebf8ff">
        </div>
          <center><div>
               <!-- Ajoutez ce bouton après le champ tauxImpot -->
<button type="button" onclick="calculerTauxImpot()" style="margin-top: 7px; width: 200px;  width: 70%;">
 Calculer imposition
</button>
<small id="helpImpot" style="display:block; margin-top:6px; color:#666;">Estimé sur un brut annuel de 21621.60 € (1 part) — Impôt total estimé : 0.00 €</small>
     </div>

  </center></div>
        <button onclick="genererPDF()">Générer paie</button>
        <div class="apercu-net" id="apercuNetAPayer">Net à payer : 1426.30 €</div>
        <button id="toggleDarkMode">Mode Sombre</button>
    </center></div>
    <!-- Scripts placés à la fin du body -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <script>
        window.onload = function () {
            const { jsPDF } = window.jspdf;

            // Constantes 2025 - Source URSSAF
            const SMIC_HORAIRE_BRUT = 11.88;
            const SMIC_MENSUEL_BRUT = 1801.80;
            const SMIC_MENSUEL_NET = 1426.30;
            const PLF_SS = 3666; // Plafond Sécurité Sociale
            const HEURES_MENSUELLES = 151.67;

            // Taux de cotisations 2025 - Source URSSAF
            const TAUX_COTISATIONS = {
                // Salariales
                salariales: {
                    maladie: { taux: 0.0075, plafonne: true },
                    vieillesse_plafonnee: { taux: 0.069, plafonne: true },
                    vieillesse_deplafonnee: { taux: 0.004, plafonne: false },
                    retraite_complementaire1: { taux: 0.0315, plafonne: true },
                    retraite_complementaire2: { taux: 0.009, plafonne: false, seuil: PLF_SS },
                    chomage: { taux: 0.024, plafonne: true },
                    csg_deductible: { taux: 0.068, plafonne: false },
                    csg_non_deductible: { taux: 0.029, plafonne: false }
                },
                // Patronales
                patronales: {
                    maladie: { taux: 0.13, plafonne: true },
                    vieillesse_plafonnee: { taux: 0.0855, plafonne: true },
                    vieillesse_deplafonnee: { taux: 0.018, plafonne: false },
                    retraite_complementaire1: { taux: 0.08, plafonne: true },
                    retraite_complementaire2: { taux: 0.016, plafonne: false, seuil: PLF_SS },
                    chomage: { taux: 0.04, plafonne: true },
                    formation_pro: { taux: 0.01, plafonne: false },
                    taxe_apprentissage: { taux: 0.0068, plafonne: false },
                    versement_mobilite: { taux: 0.01, plafonne: false },
                    ags: { taux: 0.0015, plafonne: false }
                }
            };

            // Tranches d'imposition 2025
            const TRANCHES_IMPOT = [
                { min: 0, max: 11294, taux: 0 },
                { min: 11295, max: 28797, taux: 0.11 },
                { min: 28798, max: 82341, taux: 0.30 },
                { min: 82342, max: 177106, taux: 0.41 },
                { min: 177107, max: Infinity, taux: 0.45 }
            ];

            // Calcul professionnel des cotisations
            function calculerCotisations(brut, type) {
                const cotisations = TAUX_COTISATIONS[type];
                const result = {};
                let total = 0;

                for (const [key, config] of Object.entries(cotisations)) {
                    let base = brut;
                    
                    if (config.plafonne) {
                        base = Math.min(brut, PLF_SS);
                    } else if (config.seuil) {
                        base = Math.max(0, brut - config.seuil);
                    }
                    
                    const montant = base * config.taux;
                    result[key] = montant;
                    total += montant;
                }

                result.total = total;
                return result;
            }

            // Calcul du nombre de parts fiscales
            function getNbParts() {
                const statut = parseInt(document.getElementById('statutMarital').value);
                const enfants = parseInt(document.getElementById('nbEnfants').value) || 0;
                let parts = statut === 2 ? 2 : 1;
                if (enfants > 0) parts += enfants * 0.5;
                return Math.max(1, parts);
            }

            // Calcul professionnel de l'impôt sur le revenu
            function calculerImpot(revenuBrutAnnuel, nbParts) {
                const revenuNetImposable = revenuBrutAnnuel * 0.9; // Abattement 10%
                const revenuParPart = revenuNetImposable / nbParts;
                let impot = 0;

                for (const tranche of TRANCHES_IMPOT) {
                    if (revenuParPart > tranche.min) {
                        const montantTranche = Math.min(revenuParPart, tranche.max) - tranche.min;
                        impot += montantTranche * tranche.taux;
                    }
                }

                return impot * nbParts;
            }

            // Calcul du net à payer professionnel
            function calculerNetAPayer(salaireBrut, tauxImpot = 0) {
                // Cotisations salariales
                const cotisationsSalariales = calculerCotisations(salaireBrut, 'salariales');
                const totalCotisationsSalariales = cotisationsSalariales.total;
                
                // Net imposable (pour l'impôt)
                const netImposable = salaireBrut - totalCotisationsSalariales + cotisationsSalariales.csg_non_deductible;
                
                // Impôt sur le revenu
                const impotMensuel = (netImposable * tauxImpot) / 100;
                
                // Net à payer
                const netAPayer = netImposable - impotMensuel;
                
                return {
                    netImposable: netImposable,
                    netAPayer: netAPayer,
                    cotisationsSalariales: cotisationsSalariales,
                    totalCotisationsSalariales: totalCotisationsSalariales,
                    impotMensuel: impotMensuel
                };
            }

            // Mise à jour de l'aperçu net
            function updateApercuNet() {
                const salaireBrut = parseFloat(document.getElementById("salaireBrut").value) || 0;
                const tauxImpot = parseFloat(document.getElementById("tauxImpot").value) || 0;
                
                const resultat = calculerNetAPayer(salaireBrut, tauxImpot);
                document.getElementById("apercuNetAPayer").textContent = 
                    `Net à payer : ${resultat.netAPayer.toFixed(2)} €`;
            }

            // Calcul de l'impôt et mise à jour du taux
            window.calculerTauxImpot = function() {
                const salaireBrutMensuel = parseFloat(document.getElementById('salaireBrut').value) || 0;
                const revenuBrutAnnuel = salaireBrutMensuel * 12;
                const nbParts = getNbParts();
                
                const impotAnnuel = calculerImpot(revenuBrutAnnuel, nbParts);
                const tauxImpot = (impotAnnuel / revenuBrutAnnuel) * 100;
                
                document.getElementById('tauxImpot').value = tauxImpot.toFixed(2);
                document.getElementById('helpImpot').innerHTML = 
                    `Estimé sur un brut annuel de ${revenuBrutAnnuel.toFixed(2)} € (${nbParts} part${nbParts > 1 ? 's' : ''}) — Impôt total estimé : ${impotAnnuel.toFixed(2)} €`;
                
                updateApercuNet();
            }

            // Calcul automatique du salaire brut
            function updateSalaireBrut() {
                const tauxHoraire = parseFloat(document.getElementById("tauxHoraire").value) || 0;
                const heuresMensuelles = parseFloat(document.getElementById("heuresMensuelles").value) || 0;
                const salaireBrut = tauxHoraire * heuresMensuelles;
                document.getElementById("salaireBrut").value = salaireBrut.toFixed(2);
                updateApercuNet();
            }

            // Validation des champs
            function validateInputs() {
                const requiredFields = [
                    "nomEntreprise",
                    "adresseEntreprise",
                    "siret",
                    "codeNaf",
                    "telEntreprise",
                    "emailEntreprise",
                    "nomSalarie",
                    "adresseSalarie",
                    "secuSalarie",
                    "dateEntree",
                    "posteOccupe",
                    "dateDebut",
                    "dateFin",
                    "salaireBrut"
                ];
                for (const field of requiredFields) {
                    const value = document.getElementById(field).value.trim();
                    if (!value) {
                        alert(`Le champ "${document.querySelector(`label[for=${field}]`).textContent.replace(' *', '')}" est obligatoire.`);
                        return false;
                    }
                }
                return true;
            }

            // Calcul de l'ancienneté
            function calculerAnciennete(dateEntree, dateFin) {
                const [day, month, year] = dateEntree.split("/").map(Number);
                const entree = new Date(year, month - 1, day);
                const [dayFin, monthFin, yearFin] = dateFin.split("/").map(Number);
                const fin = new Date(yearFin, monthFin - 1, dayFin);
                let diffYears = fin.getFullYear() - entree.getFullYear();
                let diffMonths = fin.getMonth() - entree.getMonth();
                let diffDays = fin.getDate() - entree.getDate();
                if (diffMonths < 0 || (diffMonths === 0 && diffDays < 0)) {
                    diffYears--;
                }
                return {
                    ans: diffYears,
                    mois: Math.abs(diffMonths + (diffDays < 0 ? -1 : 0))
                };
            }

            // Calcul des jours travaillés
            function calculerJoursTravailles(dateDebut, dateFin) {
                const [dayStart, monthStart, yearStart] = dateDebut.split("/").map(Number);
                const [dayEnd, monthEnd, yearEnd] = dateFin.split("/").map(Number);
                const debut = new Date(yearStart, monthStart - 1, dayStart);
                const fin = new Date(yearEnd, monthEnd - 1, dayEnd);
                const diffTime = Math.abs(fin - debut);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                return diffDays;
            }

            // Génération du PDF avec votre design original
            window.genererPDF = function () {
                if (!validateInputs()) return;

                // Récupération des données
                const nomEntreprise = document.getElementById("nomEntreprise").value;
                const adresseEntreprise = document.getElementById("adresseEntreprise").value;
                const siret = document.getElementById("siret").value;
                const codeNaf = document.getElementById("codeNaf").value;
                const telEntreprise = document.getElementById("telEntreprise").value;
                const faxEntreprise = document.getElementById("faxEntreprise").value;
                const emailEntreprise = document.getElementById("emailEntreprise").value;
                const nomSalarie = document.getElementById("nomSalarie").value;
                const adresseSalarie = document.getElementById("adresseSalarie").value;
                const emailSalarie = document.getElementById("emailSalarie").value;
                const telSalarie = document.getElementById("telSalarie").value;
                const secuSalarie = document.getElementById("secuSalarie").value.replace(/\s/g, "");
                const dateEntree = document.getElementById("dateEntree").value;
                const posteOccupe = document.getElementById("posteOccupe").value;
                const dateDebut = document.getElementById("dateDebut").value;
                const dateFin = document.getElementById("dateFin").value;
                const salaireBrutMensuel = parseFloat(document.getElementById("salaireBrut").value);
                const tauxHoraire = parseFloat(document.getElementById("tauxHoraire").value) || 0;
                const heuresMensuelles = parseFloat(document.getElementById("heuresMensuelles").value) || 0;
                const heuresSup = parseFloat(document.getElementById("heuresSupplementaires").value) || 0;
                const majorationHS = parseFloat(document.getElementById("majorationHeuresSup").value) || 0;
                const statutMarital = parseInt(document.getElementById("statutMarital").value);
                const nbEnfants = parseInt(document.getElementById("nbEnfants").value);
                const tauxImpot = parseFloat(document.getElementById("tauxImpot").value) || 0;
                const couleurTheme = document.getElementById("couleurTheme").value;

                // Calculs
                const anciennete = calculerAnciennete(dateEntree, dateFin);
                const [jourDebut, mois, annee] = dateDebut.split("/").map(Number);
                const joursDansLeMois = new Date(annee, mois, 0).getDate();
                const joursTravailles = calculerJoursTravailles(dateDebut, dateFin);
                const salaireBrutProrata = (salaireBrutMensuel / joursDansLeMois) * joursTravailles;
                const tauxHoraireMajoré = tauxHoraire * (1 + majorationHS / 100);
                const salaireBrutHSup = heuresSup * tauxHoraireMajoré;
                const salaireBrutTotal = salaireBrutProrata + salaireBrutHSup;

                // Calculs professionnels
                const result = calculerNetAPayer(salaireBrutTotal, tauxImpot);
                const cotisationsPatronales = calculerCotisations(salaireBrutTotal, 'patronales');

                // Création du PDF
                const doc = new jsPDF();
                const rgbColor = hexToRgb(couleurTheme);

                // Ajouter un encadrement avec des coins arrondis et une couleur dynamique
                const marginX = 10;
                const marginY = 10;
                const pageWidth = 210 - 2 * marginX;
                const pageHeight = 297 - 2 * marginY;
                const borderRadius = 5;
                const lineWidth = 0.25;
                doc.setDrawColor(rgbColor.r, rgbColor.g, rgbColor.b);
                doc.setLineWidth(lineWidth);
                doc.roundedRect(marginX, marginY, pageWidth, pageHeight, borderRadius, borderRadius);

                // Titre centré en haut du PDF avec logo
                doc.setFontSize(14);
                doc.setTextColor(0, 0, 0);

                // Logo intégré
                const logoUrl = "https://i.ibb.co/xt29fGV3/téléchargement-removebg-preview.png";
                const imgWidth = 18;
                const imgHeight = 9;
                const imgX = 46;
                const textX = 130;

                try {
                    doc.addImage(logoUrl, 'JPEG', imgX, 13, imgWidth, imgHeight);
                    doc.text("BULLETIN DE SALAIRE", textX, 18, { align: 'left' });
                } catch (error) {
                    console.warn("Impossible de charger le logo:", error);
                    doc.text("BULLETIN DE SALAIRE", 105, 18, { align: 'center' });
                }

                // Informations entreprise
                const infosEntreprise = [
                    nomEntreprise,
                    adresseEntreprise,
                    `SIRET : ${siret}`,
                    `Code NAF : ${codeNaf}`,
                    `Tel : ${telEntreprise}`,
                    `Fax : ${faxEntreprise}`,
                    `Email : ${emailEntreprise}`
                ];
                const yEntrepriseStart = 23;
                const yEntrepriseHeight = 34;
                doc.setFillColor(rgbColor.r, rgbColor.g, rgbColor.b);
                doc.roundedRect(15, yEntrepriseStart, 80, yEntrepriseHeight, 3, 3, "F");
                let yPositionEntreprise = yEntrepriseStart + (yEntrepriseHeight / 3) - ((infosEntreprise.length * 2) / 3);
                infosEntreprise.forEach((line) => {
                    doc.setFontSize(9);
                    doc.setTextColor(0, 0, 0);
                    doc.text(line, 20, yPositionEntreprise, { align: 'left' });
                    yPositionEntreprise += 4;
                });

                // Informations salarié
                const infosSalarie = [
                    nomSalarie,
                    adresseSalarie,
                    `N° DE SECURITE SOCIAL : ${secuSalarie}`,
                    `Date d'entrée : ${dateEntree} (${anciennete.ans} ans ${anciennete.mois} mois)`,
                    `Poste Occupé : ${posteOccupe}`,
                    `Tel : ${telSalarie}`,
                    `Email : ${emailSalarie}`
                ];
                const ySalarieStart = 23;
                const ySalarieHeight = 34;
                doc.setFillColor(rgbColor.r, rgbColor.g, rgbColor.b);
                doc.roundedRect(115, ySalarieStart, 80, ySalarieHeight, 3, 3, "F");
                let yPositionSalarie = ySalarieStart + (ySalarieHeight / 3) - ((infosSalarie.length * 2) / 3);
                infosSalarie.forEach((line) => {
                    doc.setFontSize(9);
                    doc.setTextColor(0, 0, 0);
                    doc.text(line, 120, yPositionSalarie, { align: 'left' });
                    yPositionSalarie += 4;
                });

                // Période de paie
                doc.setFont(undefined, 'bold');
                doc.setFontSize(10);
                doc.setTextColor(rgbColor.r, rgbColor.g, rgbColor.b);
                doc.text("PERIODE :", 105, yPositionEntreprise + 8, { align: 'center' });
                doc.setFontSize(9);
                doc.setTextColor(0, 0, 0);
                doc.text(`${dateDebut} au ${dateFin}`, 105, yPositionEntreprise + 13, { align: 'center' });
                doc.setFont(undefined, 'normal');

                // Tableau des cotisations
                const lignesPaie = [
                    ["SALAIRE BRUT MENSUEL", "", "", salaireBrutMensuel.toFixed(2), "", ""],
                    ["SALAIRE BRUT PRORATA", "", "", salaireBrutProrata.toFixed(2), "", ""],
                    ["HEURES SUPPLÉMENTAIRES", heuresSup.toFixed(2), `${majorationHS}%`, "", salaireBrutHSup.toFixed(2), ""],
                    ["Taux horaire", tauxHoraire.toFixed(2), "", "", "", ""],
                    ["Heures travaillées", heuresMensuelles.toFixed(2), "", "", "", ""],
                    ["COTISATIONS SALARIALES", "", "", "", "", ""],
                    ["Maladie - maternité - invalidité - décès", "", "0.75%", result.cotisationsSalariales.maladie.toFixed(2), "", ""],
                    ["Assurance vieillesse plafonnée", "", "6.9%", result.cotisationsSalariales.vieillesse_plafonnee.toFixed(2), "", ""],
                    ["Assurance vieillesse déplafonnée", "", "0.4%", result.cotisationsSalariales.vieillesse_deplafonnee.toFixed(2), "", ""],
                    ["Retraite complémentaire tranche 1", "", "3.15%", result.cotisationsSalariales.retraite_complementaire1.toFixed(2), "", ""],
                    ["Retraite complémentaire tranche 2", "", "0.9%", result.cotisationsSalariales.retraite_complementaire2.toFixed(2), "", ""],
                    ["Chômage", "", "2.4%", result.cotisationsSalariales.chomage.toFixed(2), "", ""],
                    ["CSG déductible", "", "6.8%", result.cotisationsSalariales.csg_deductible.toFixed(2), "", ""],
                    ["CSG/CRDS non déductible", "", "2.9%", result.cotisationsSalariales.csg_non_deductible.toFixed(2), "", ""],
                    ["Impôt sur le revenu prélevé à la source", "", tauxImpot.toFixed(1) + "%", result.impotMensuel.toFixed(2), "", ""],
                    ["CONGÉS PAYÉS (10%)", "", "10%", (salaireBrutTotal * 0.1).toFixed(2), "", ""],
                    ["", "", "TOTAL SALARIAL", result.totalCotisationsSalariales.toFixed(2), "", ""],
                    ["COTISATIONS PATRONALES", "", "", "", "", ""],
                    ["Maladie - maternité - invalidité - décès", "", "13%", "", "", cotisationsPatronales.maladie.toFixed(2)],
                    ["Assurance vieillesse plafonnée", "", "8.55%", "", "", cotisationsPatronales.vieillesse_plafonnee.toFixed(2)],
                    ["Assurance vieillesse déplafonnée", "", "1.8%", "", "", cotisationsPatronales.vieillesse_deplafonnee.toFixed(2)],
                    ["Retraite complémentaire tranche 1", "", "8%", "", "", cotisationsPatronales.retraite_complementaire1.toFixed(2)],
                    ["Retraite complémentaire tranche 2", "", "1.6%", "", "", cotisationsPatronales.retraite_complementaire2.toFixed(2)],
                    ["Chômage", "", "4%", "", "", cotisationsPatronales.chomage.toFixed(2)],
                    ["Formation professionnelle", "", "1%", "", "", cotisationsPatronales.formation_pro.toFixed(2)],
                    ["Taxe d'apprentissage", "", "0.68%", "", "", cotisationsPatronales.taxe_apprentissage.toFixed(2)],
                    ["Versement mobilité", "", "1%", "", "", cotisationsPatronales.versement_mobilite.toFixed(2)],
                    ["Cotisation AGS", "", "0.15%", "", "", cotisationsPatronales.ags.toFixed(2)],
                    ["", "", "TOTAL PATRONAL", "", "", cotisationsPatronales.total.toFixed(2)],
                    ["NET IMPOSABLE", "", "", result.netImposable.toFixed(2), "", ""],
                    ["NET À PAYER EN EUROS", "", "", result.netAPayer.toFixed(2), "", ""]
                ];

                // Calcul de la largeur totale du tableau
                const columnWidths = [60, 15, 15, 25, 25, 30];
                const totalTableWidth = columnWidths.reduce((a, b) => a + b, 0);
                const startX = (210 - totalTableWidth) / 2;
                const tableStartY = yPositionEntreprise + 23;

                // Ajout d'un rectangle pour l'en-tête du tableau centré
                doc.setDrawColor(rgbColor.r, rgbColor.g, rgbColor.b);
                doc.setFillColor(rgbColor.r, rgbColor.g, rgbColor.b);
                doc.roundedRect(startX, tableStartY, totalTableWidth, 9, 2, 2, "FD");

                // Ajout du tableau des cotisations centré
                doc.autoTable({
                    startY: tableStartY + 7,
                    head: [["ÉLÉMENTS DE PAIE", "BASE", "TAUX", "À DÉDUIRE", "À PAYER", "CHARGES PATRONALES"]],
                    body: lignesPaie,
                    margin: { left: startX },
                    styles: {
                        fontSize: 7,
                        cellPadding: 1.42,
                        overflow: 'linebreak',
                        minCellHeight: 4.3,
                        halign: 'left',
                        textColor: [0, 0, 0]
                    },
                    headStyles: {
                        fillColor: [rgbColor.r, rgbColor.g, rgbColor.b],
                        textColor: [0, 0, 0],
                        fontSize: 7,
                        cellPadding: 2.2,
                        halign: 'center'
                    },
                    columnStyles: {
                        0: { cellWidth: columnWidths[0], fontStyle: 'bold', halign: 'left' },
                        1: { cellWidth: columnWidths[1], halign: 'center' },
                        2: { cellWidth: columnWidths[2], halign: 'center' },
                        3: { cellWidth: columnWidths[3], halign: 'right' },
                        4: { cellWidth: columnWidths[4], halign: 'right' },
                        5: { cellWidth: columnWidths[5], halign: 'right' }
                    },
                    bodyStyles: { valign: 'middle' },
                    alternateRowStyles: { fillColor: [rgbColor.r, rgbColor.g, rgbColor.b] },
                    tableWidth: 'fixed'
                });

                // Sauvegarde du PDF
                doc.save(`bulletin_paie_${nomSalarie.replace(/\s+/g, '_')}.pdf`);
                alert("Fiche de paie générée avec succès !");
            };

            // Fonction utilitaire pour convertir une couleur hexadécimale en RGB
            function hexToRgb(hex) {
                const bigint = parseInt(hex.slice(1), 16);
                const r = (bigint >> 16) & 255;
                const g = (bigint >> 8) & 255;
                const b = bigint & 255;
                return { r, g, b };
            }

            // Événements pour le calcul automatique
            document.getElementById("tauxHoraire").addEventListener("input", updateSalaireBrut);
            document.getElementById("heuresMensuelles").addEventListener("input", updateSalaireBrut);
            document.getElementById("salaireBrut").addEventListener("input", updateApercuNet);
            document.getElementById("tauxImpot").addEventListener("input", updateApercuNet);
            document.getElementById("statutMarital").addEventListener("change", calculerTauxImpot);
            document.getElementById("nbEnfants").addEventListener("change", calculerTauxImpot);

            // Mode sombre
            document.getElementById("toggleDarkMode").addEventListener("click", function () {
                document.body.classList.toggle("dark-mode");
            });

            // Initialisation
            updateApercuNet();
        };

        // Désactiver le clic droit
        document.addEventListener('contextmenu', function(event) {
            event.preventDefault();
        });
    </script>
</body>
</html>
